{
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1008,
        240
      ],
      "id": "67f9608f-cadd-4121-8f92-584892f8fa98",
      "name": "Schedule Trigger (8:00am Daily"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk",
          "mode": "list",
          "cachedResultName": "Naira Exchange Rate Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 557843046,
          "mode": "list",
          "cachedResultName": "RawDataLog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit#gid=557843046"
        },
        "options": {
          "returnFirstMatch": true
        }
      },
      "id": "644618de-f0a9-461c-9bfe-7f91b3ec08d7",
      "name": "Yesterday's Rate",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -784,
        240
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "wXAfa4Y67s1bUqQ2",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.exchangerate-api.com/v4/latest/NGN",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -560,
        312
      ],
      "id": "61288cc8-8335-4902-97f9-5f16eeea40c8",
      "name": "Get Today's Rate"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -336,
        144
      ],
      "id": "0eb2cbc1-8aae-404c-96b9-8ce935314d2f",
      "name": "Merge Rate for Analysis"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk",
          "mode": "list",
          "cachedResultName": "Naira Exchange Rate Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 557843046,
          "mode": "list",
          "cachedResultName": "RawDataLog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit#gid=557843046"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Date": "={{ $now.toFormat('yyyy-MM-dd') }}",
            "USD": "=={{ $json.rates.USD }}",
            "GBP": "={{ $json.rates.GBP }}",
            "EUR": "={{ $json.rates.EUR }}",
            "CNY": "={{ $json.rates.CNY }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "USD",
              "displayName": "USD",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "GBP",
              "displayName": "GBP",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "EUR",
              "displayName": "EUR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CNY",
              "displayName": "CNY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "41e2dcdd-baac-4dd8-994e-bdbdc72bedcd",
      "name": "Log Today's rate for Tomorrow's analysis",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -336,
        336
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "wXAfa4Y67s1bUqQ2",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Data from HTTP Request (today's rates) is the first input\nconst todayRatesData = items[0].json;\nconst todayRates = {\n  USD: todayRatesData.rates.USD,\n  GBP: todayRatesData.rates.GBP,\n  EUR: todayRatesData.rates.EUR,\n  CNY: todayRatesData.rates.CNY\n};\n\n// Data from Google Sheets (yesterday's rates) is the second input\nconst yesterdayRatesData = items[1].json;\n// Values from Google Sheets can be strings, so we parse them\nconst yesterdayRates = {\n  USD: parseFloat(yesterdayRatesData.USD),\n  GBP: parseFloat(yesterdayRatesData.GBP),\n  EUR: parseFloat(yesterdayRatesData.EUR),\n  CNY: parseFloat(yesterdayRatesData.CNY)\n};\n\nconst changes = {};\nfor (const currency of Object.keys(todayRates)) {\n  const today = todayRates[currency];\n  const yesterdayVal = yesterdayRates[currency];\n\n  // Basic check to ensure yesterday's value is valid\n  if (isNaN(yesterdayVal) || yesterdayVal === 0) {\n    changes[currency] = { percent: 'N/A', direction: 'unchanged', emoji: 'â–' };\n    continue;\n  }\n\n  const diff = today - yesterdayVal;\n  // Using toFixed(6) for better precision with small numbers\n  const percent = ((diff / yesterdayVal) * 100).toFixed(4);\n  const direction = diff > 0 ? \"up\" : diff < 0 ? \"down\" : \"unchanged\";\n  const emoji = direction === \"up\" ? \"ğŸ“ˆ\" : direction === \"down\" ? \"ğŸ“‰\" : \"â–\";\n\n  changes[currency] = { percent, direction, emoji };\n}\n\n// Return a single structured object\nreturn [{\n  json: {\n    currentRates: todayRates,\n    previousRates: yesterdayRates,\n    changes: changes\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        144
      ],
      "id": "f4a1c769-05de-4b95-916c-0308d7df4a2f",
      "name": "Exchange Rate Calculations and text Formatting"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a financial analyst. Based on the following exchange rate data, generate a professional and engaging summary report.\n\nToday's rates:\n- 1 Naira = {{ $json.currentRates.USD }} US Dollar (USD)\n- 1 Naira = {{ $json.currentRates.GBP }} British Pound (GBP)\n- 1 Naira = {{ $json.currentRates.EUR }} Euro (EUR)\n- 1 Naira = {{ $json.currentRates.CNY }} Chinese Yuan (CNY)\n\nYesterday's rates:\n- 1 Naira = {{ $json.previousRates.USD }} US Dollar (USD)\n- 1 Naira = {{ $json.previousRates.GBP }} British Pound (GBP)\n- 1 Naira = {{ $json.previousRates.EUR }} Euro (EUR)\n- 1 Naira = {{ $json.previousRates.CNY }} Chinese Yuan (CNY)\n\nRate changes:\n- USD: {{ $json.changes.USD.percent }}% ({{ $json.changes.USD.direction }})\n- GBP: {{ $json.changes.GBP.percent }}% ({{ $json.changes.GBP.direction }})\n- EUR: {{ $json.changes.EUR.percent }}% ({{ $json.changes.EUR.direction }})\n- CNY: {{ $json.changes.CNY.percent }}% ({{ $json.changes.CNY.direction }})\n\nInstructions:\n- Write a summary paragraph with insights on how NGN is performing against major global currencies.\n- Mention any notable trends or shifts and a brief economic commentary.\n- Ensure the output is well-formatted for readability.\n- Format the output as JSON with fields: summary, rates, and insight.",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        112,
        172
      ],
      "id": "5499bd33-a1f7-4d20-ac14-e1d88e667ee4",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-r1:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        120,
        396
      ],
      "id": "c1d6738a-1266-4ea8-b033-9c27c451e4f0",
      "name": "Chat Model (DeepSeek)",
      "credentials": {
        "openRouterApi": {
          "id": "45vEjqXrgijuDoCV",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"summary\": { \"type\": \"string\" },\n    \"rates\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"NGN\": { \"type\": \"number\" },\n        \"USD\": { \"type\": \"number\" },\n        \"GBP\": { \"type\": \"number\" },\n        \"EUR\": { \"type\": \"number\" },\n        \"CNY\": { \"type\": \"number\" }\n      }\n    },\n    \"insight\": { \"type\": \"string\" }\n  },\n  \"required\": [\"summary\", \"rates\", \"insight\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        248,
        396
      ],
      "id": "97278516-f9ac-4fe7-9748-191ffd3aefd4",
      "name": "Output Parser"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        464,
        144
      ],
      "id": "b81d8dc6-a642-4078-881e-7ef521ef4f12",
      "name": "Merge results for delivery"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk",
          "mode": "list",
          "cachedResultName": "Naira Exchange Rate Logs",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1017243258,
          "mode": "list",
          "cachedResultName": "FullReportLog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1OFaufpx9h4Uut1lMOn_Ju8ZAFgwl-2T5UMpbaJygDLk/edit#gid=1017243258"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Summary": "={{ $json.output.summary }}",
            "Insight": "={{ $json.output.insight }}",
            "USD": "={{ $json.currentRates.USD }}",
            "GBP": "={{ $json.currentRates.GBP }}",
            "EUR": "={{ $json.currentRates.EUR }}",
            "CNY": "={{ $json.currentRates.CNY }}",
            "Date": "={{ $now.toFormat('yyyy-MM-dd') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Summary",
              "displayName": "Summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Insight",
              "displayName": "Insight",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "USD",
              "displayName": "USD",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "GBP",
              "displayName": "GBP",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "EUR",
              "displayName": "EUR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CNY",
              "displayName": "CNY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        688,
        144
      ],
      "id": "109cfd6c-40f1-40dd-b069-5479b69106c2",
      "name": "Log Full Report to Google Sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "wXAfa4Y67s1bUqQ2",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "1749916690",
        "text": "=ğŸ“Š *Naira Exchange Rate Summary Report*\n*Date:* {{ $now.toFormat('DD') }} | *Time:* 8:00am (GMT+1)\n\nğŸ’± *Current Exchange Rates*\nğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡ºğŸ‡¸ 1 Naira = {{ $json.currentRates.USD }} USD  \nğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡¬ğŸ‡§ 1 Naira = {{ $json.currentRates.GBP }} GBP  \nğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡ªğŸ‡º 1 Naira = {{ $json.currentRates.EUR }} EUR  \nğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡¨ğŸ‡³ 1 Naira = {{ $json.currentRates.CNY }} CNY  \n\nğŸ“Š *Daily Change*\nğŸ‡ºğŸ‡¸ USD: {{ $json.changes.USD.percent }}% {{ $json.changes.USD.emoji }}  \nğŸ‡¬ğŸ‡§ GBP: {{ $json.changes.GBP.percent }}% {{ $json.changes.GBP.emoji }}  \nğŸ‡ªğŸ‡º EUR: {{ $json.changes.EUR.percent }}% {{ $json.changes.EUR.emoji }}  \nğŸ‡¨ğŸ‡³ CNY: {{ $json.changes.CNY.percent }}% {{ $json.changes.CNY.emoji }}  \n\nğŸ“Œ *Market Insight* \n{{ $json.output.summary }}\n\nğŸ“ˆ *Economic Commentary* \n{{ $json.output.insight }}\n\n_This report was automatically generated by your AI-powered financial assistant using n8n._",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        688,
        336
      ],
      "id": "f5cd9c4b-f750-464b-bf57-37e01183cba4",
      "name": "Send Summary to Telegram Bot",
      "webhookId": "cb7ab450-1f88-479e-af38-70f98b9fcf2e",
      "credentials": {
        "telegramApi": {
          "id": "0nkO8rZ2E5iqSxRd",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "oluwalowojohn@gmail.com",
        "subject": "=Naira Exchange Rate Summary â€“ {{ $today }}",
        "message": "=<h2>ğŸ“Š Naira Exchange Rate Summary Report</h2>\n<p><strong>Date:</strong> {{ $now.toFormat('DD') }} &nbsp;&nbsp; <strong>Time:</strong> 8:00am (GMT+1)</p>\n<p>Stay ahead of the curve with todayâ€™s snapshot of how the <strong>Naira</strong> is trading globally.</p>\n\n<h3>ğŸ’± Current Exchange Rates</h3>\n<ul>\n  <li>ğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡ºğŸ‡¸ 1 Naira = {{ $json.currentRates.USD }} USD</li>\n  <li>ğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡¬ğŸ‡§ 1 Naira = {{ $json.currentRates.GBP }} GBP</li>\n  <li>ğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡ªğŸ‡º 1 Naira = {{ $json.currentRates.EUR }} EUR</li>\n  <li>ğŸ‡³ğŸ‡¬â¡ï¸ğŸ‡¨ğŸ‡³ 1 Naira = {{ $json.currentRates.CNY }} CNY</li>\n</ul>\n\n<h3>ğŸ“Š Daily Change</h3>\n<ul>\n  <li>ğŸ‡ºğŸ‡¸ USD: {{ $json.changes.USD.percent }}% {{ $json.changes.USD.emoji }}</li>\n  <li>ğŸ‡¬ğŸ‡§ GBP: {{ $json.changes.GBP.percent }}% {{ $json.changes.GBP.emoji }}</li>\n  <li>ğŸ‡ªğŸ‡º EUR: {{ $json.changes.EUR.percent }}% {{ $json.changes.EUR.emoji }}</li>\n  <li>ğŸ‡¨ğŸ‡³ CNY: {{ $json.changes.CNY.percent }}% {{ $json.changes.CNY.emoji }}</li>\n</ul>\n\n<h3>ğŸ“Œ Market Insight</h3>\n<p>{{ $json.output.summary }}</p>\n\n<h3>ğŸ“ˆ Economic Commentary</h3>\n<p>{{ $json.output.insight }}</p>\n\n<hr>\n<p style=\"font-style: italic;\">This report was automatically generated by your AI-powered financial assistant using n8n.</p>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        688,
        -48
      ],
      "id": "7c309773-de21-42a8-b6de-ae547cf70c65",
      "name": "Send Summary to Gmail Inbox",
      "webhookId": "77d15c41-d47d-4484-b53f-ca678cc81734",
      "credentials": {
        "gmailOAuth2": {
          "id": "d5ljNKIIRxJqX2vl",
          "name": "Gmail account"
        }
      }
    }
  ],
  "connections": {
    "Schedule Trigger (8:00am Daily": {
      "main": [
        [
          {
            "node": "Yesterday's Rate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Yesterday's Rate": {
      "main": [
        [
          {
            "node": "Get Today's Rate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Rate for Analysis",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get Today's Rate": {
      "main": [
        [
          {
            "node": "Log Today's rate for Tomorrow's analysis",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Rate for Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Rate for Analysis": {
      "main": [
        [
          {
            "node": "Exchange Rate Calculations and text Formatting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Today's rate for Tomorrow's analysis": {
      "main": [
        []
      ]
    },
    "Exchange Rate Calculations and text Formatting": {
      "main": [
        [
          {
            "node": "Merge results for delivery",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Merge results for delivery",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Chat Model (DeepSeek)": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Merge results for delivery": {
      "main": [
        [
          {
            "node": "Send Summary to Gmail Inbox",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Summary to Telegram Bot",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Full Report to Google Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Summary to Telegram Bot": {
      "main": [
        []
      ]
    },
    "Send Summary to Gmail Inbox": {
      "main": [
        []
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "db6a6a071dfca2e0d35fcf3e9f98b59e5ea7c188360bda9a81a90f32d133305b"
  }
}
